---
import BaseLayout from "./BaseLayout.astro"
import AuthorInfo from "@components/AuthorInfo";
import { getAuthor } from "src/authors";
import { PostFrontmatter, PostOrPageFrontmatter } from "src/types";
import { MarkdownContent, MarkdownInstance } from "astro";
import PostLastNextNav from "@components/PostLastNextNav";

export interface Props {
  content: MarkdownContent<PostOrPageFrontmatter>;
}

const { content } = Astro.props as Props;

let allPosts = await Astro.glob<PostFrontmatter>('../pages/blog/posts/*.md');
allPosts = allPosts.sort(
  (a, b) => new Date(b.frontmatter.publication_date).valueOf() -
    new Date(a.frontmatter.publication_date).valueOf()
);
const foundAt = allPosts.findIndex(
  (p) => p.frontmatter.slug === content.slug
);
let lastPost: MarkdownInstance<PostFrontmatter> = null;
let nextPost: MarkdownInstance<PostFrontmatter> = null;
if (foundAt !== -1) {
  lastPost = allPosts[foundAt + 1] ?? null;
  nextPost = allPosts[foundAt - 1] ?? null;
}

---

<BaseLayout>
  <article
    class="px-4 mx-auto my-10 prose dark:prose-invert xl:prose-xl md:my-20 md:px-0 font-serif prose-h1:font-sans">
    <slot />
    <hr />
    <AuthorInfo author={getAuthor(content.author)} />
    <PostLastNextNav last={lastPost?.frontmatter} next={nextPost?.frontmatter} />
    <script src="https://utteranc.es/client.js" repo="intagaming/hxann.com" issue-term="pathname" theme="github-dark"
      crossorigin="anonymous" async>
      </script>
  </article>
</BaseLayout>